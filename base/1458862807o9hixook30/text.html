<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif';">Итак, как когда-то обещал, инструкция как сделать удаление рекламы/блокирование вредоносных сайтов средствами роутера, а не кривыми до ужОса браузерными плагинами типа AdBlock.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif';"><br />В основном ресурсы роутера стоят в простое (окромя времени когда торрентокачалка работает) что есть нехорошо поэтому начнем.<br /><br />Инструкция для прошивок </span><span style=" font-family:'Sans Serif'; font-weight:600;">Gargoyle</span><span style=" font-family:'Sans Serif';"> и </span><span style=" font-family:'Sans Serif'; font-weight:600;">OpenWRT</span><span style=" font-family:'Sans Serif';"> но так как основа это баш скрипт то портировать ее легко на любую прошивку (</span><span style=" font-family:'Sans Serif'; font-weight:600;">DD-WRT</span><span style=" font-family:'Sans Serif';"> и т.д.)<br /><br />1. Открываем файл /etc/firewall.user и добавляем в него строчки<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; font-size:10pt; color:#6a0e07;">iptables -t nat -I PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 53<br />iptables -t nat -I PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 53</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif';"><br />2. Открываем файл /etc/config/dhcp и добавляем в него строчки в конце секции &quot;config dnsmasq&quot;<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; font-size:10pt; color:#6a0e07;">list addnhosts '/tmp/block.host'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif';"><br />3. Открываем файл /etc/rc.local и добавляем в него строчки<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; font-size:10pt; color:#6a0e07;">#Download and process the files needed to make the lists<br />sleep 10<br />(<br />wget -qO- http://www.mvps.org/winhelp2002/hosts.txt| sed 's/0.0.0.0/127.0.0.1/g' |grep &quot;^127.0.0.1&quot; &gt; /tmp/block.host<br />wget -qO- http://www.malwaredomainlist.com/hostslist/hosts.txt|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://hosts-file.net/.\ad_servers.txt&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://adaway.org/hosts.txt&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://sysctl.org/cameleon/hosts.win&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://pgl.yoyo.org/as/serverlist.php?hostformat=hosts&amp;showintro=1&amp;mimetype=plaintext&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://jazz.tvtom.pl/download/hosts&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://www.malekal.com/HOSTS_filtre/HOSTS.txt&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://blog.ksx4system.net/wp-content/uploads/blocklista.txt&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://someonewhocares.org/hosts/hosts&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />wget -qO- &quot;http://www.malwaredomainlist.com/hostslist/hosts.txt&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />#wget -qO- &quot;http://support.it-mate.co.uk/downloads/hosts.txt&quot;|grep &quot;^127.0.0.1&quot; &gt;&gt; /tmp/block.host<br />#Add black list, if non-empty<br />[ -s &quot;/etc/black.list&quot; ] &amp;&amp; awk '/^[^#]/ { print &quot;127.0.0.1&quot;,$1 }' /etc/black.list &gt;&gt; /tmp/block.host<br />#Sort the download/black lists<br />awk '{sub(/\r$/,&quot;&quot;);print $1,$2}' /tmp/block.host|sort|uniq &gt; /tmp/sorted<br />#Filter the blacklist, supressing whitelist matches<br />awk '/^[^#]/ {sub(/\r$/,&quot;&quot;);print $1}' /etc/white.list | grep -vf - /tmp/sorted &gt; /tmp/block.host<br />/etc/init.d/dnsmasq restart ) &amp;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier 10 Pitch'; font-size:10pt; color:#6a0e07;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif';">4. Создаем файлы </span><span style=" font-family:'Courier 10 Pitch'; font-size:10pt; color:#6a0e07;">/etc/black.list</span><span style=" font-family:'Sans Serif';"> и </span><span style=" font-family:'Courier 10 Pitch'; font-size:10pt; color:#6a0e07;">/etc/white.list</span><span style=" font-family:'Sans Serif';"> это будут черный список в который мы можем добавлять сайты для блокировки и белый список в котором помещаем сайты которые не должны блокироватся<br /><br />Вот и все, теперь реклама и т.д. режется на всех ваших устройствах начиная от смартфонов и заканчивая стационарными компьютерами, притом не используя их ресурсы. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans Serif';"><br /></p></body></html>