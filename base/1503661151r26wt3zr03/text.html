<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">В сети есть обсуждение такого нерешенного вопроса:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.linux.org.ru/forum/admin/12726837"><span style=" font-family:'Arial'; text-decoration: underline; color:#0000ff;">Работа Git (например с GitHub) через SOCKS5 Proxy в условиях отсутствия DNS</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">Кратко, проблема вот в чем:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:10pt; font-style:italic;">Нахожусь в корпоративной сети. Имею доступ как пользователь к линуховому серверу, у которого есть выход в интернет. Захожу на этот сервер по SSH через Putty.<br /><br />На рабочем месте Windows 7. Для серфинга включаю Putty, которая делает туннель и поднимает локально на машине порт SOCKS5 Proxy. Запускаю FireFox, у которого настроено использование SOCKS5 Proxy, и стоит галочка «Удаленный DNS» (в других браузерах, кстати, такой настройки не предусмотрено, поэтому они не подходят). И интернет в FireFox работает.<br /><br />Теперь мне нужно начать работать с git. В git есть глобальные настройки:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">&gt; git config --list</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">http.proxy='socks5://127.0.0.1:9999'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">https.proxy='socks5://127.0.0.1:9999'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">socks.proxy=127.0.0.1:9999</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">socks5.proxy=127.0.0.1:9999</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:10pt; font-style:italic;"><br />Однако при попытке запушить изменения, получаю ошибку:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">&gt; git push</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">ssh: github.com: no address associated with name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">fatal: Could not read from remote repository.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:10pt; font-style:italic;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">Please make sure you have the correct access rights</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:10pt; font-style:italic;">and the repository exists.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:10pt; font-style:italic;"><br />Похоже, что ошибка эта из-за того, что git не умеет резолвить DNS-имена через SOCKS5 Proxy, а просто пользуется тем что есть в системе. А может быть, нужна какая-то дополнительная настройка.</span><span style=" font-family:'Arial';"><br /></span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">В ответ на этот вопрос было предложено решение: прописать IP адрес github.com в файл windows\system32\drivers\etc\hosts. Проблема в том, что это решение не помогает, потому что вопрос оказался куда сложнее.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-weight:600; font-style:italic;">Перед дальнейшим обсуждением, подведу краткий итог. Для организации доступа Git в Интернет надо:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial'; font-style:italic;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:80px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-weight:600; font-style:italic;">1.</span><span style=" font-family:'Arial'; font-style:italic;"> Иметь запущенным Putty с проброшенным SOCKS5 туннелем (опция -D):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:80px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial'; font-style:italic;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:120px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-style:italic; color:#6a1009;">putty.exe -load funnyLinuxHost -D 9999 10.159.168.48</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:80px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial'; font-style:italic;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:80px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-weight:600; font-style:italic;">2.</span><span style=" font-family:'Arial'; font-style:italic;"> В конфиге Git (в каталоге пользователя есть файл </span><span style=" font-family:'Courier New'; font-style:italic; color:#6a1009;">.gitconfig</span><span style=" font-family:'Arial'; font-style:italic;">) иметь, как минимум, опцию:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:80px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial'; font-style:italic;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:120px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-style:italic; color:#6a1009;">[http]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:120px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-style:italic; color:#6a1009;">	proxy = socks5://127.0.0.1:9999</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:80px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial'; font-style:italic;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:80px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-weight:600; font-style:italic;">3.</span><span style=" font-family:'Arial'; font-style:italic;"> В файле </span><span style=" font-family:'Courier New'; font-style:italic; color:#6a1009;">hosts</span><span style=" font-family:'Arial'; font-style:italic;"> иметь интернетовый IP-адрес для доменного имени </span><span style=" font-family:'Courier New'; font-style:italic; color:#6a1009;">github.com</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial'; font-style:italic;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-style:italic;">А что нужно еще, написано дальше.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">Долгие попытки настройки показали, что обращение к socks-прокси возможно только при использовании http/https протокола. Git не работает через socks5-прокси, если адрес репозитария прописан по протоколу </span><span style=" font-family:'Arial'; font-weight:600;">git</span><span style=" font-family:'Arial';">, например </span><span style=" font-family:'Courier New'; color:#6a1009;">git@github.com:xintrea/monitoring-sp.git</span><span style=" font-family:'Arial';">. Обнаружить эту особенность в документации мне не удалось (может быть плохо читал), но по факту это так.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">Если поменять в настройках репозитария адрес сервера на протокол https (например на </span><span style=" font-family:'Courier New'; color:#6a1009;">https://github.com/xintrea/monitoring-sp.git</span><span style=" font-family:'Arial';">), то Git начинает соединяться с github. (Настройки репозитария проще всего поменять в файле </span><span style=" font-family:'Courier New'; color:#6a1009;">./git/config</span><span style=" font-family:'Arial';">, опция </span><span style=" font-family:'Courier New'; color:#6a1009;">url</span><span style=" font-family:'Arial';">). Казалось бы, проблема решена. Но нет, тут вступает в дело политика самого GitHub.com.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">Дело в том, что соединение на внесение изменений в репозитарий (например </span><span style=" font-family:'Courier New'; color:#6a1009;">git push</span><span style=" font-family:'Arial';">) на сервисе GitHub.com допустимо как про протоколу git, так и по протоколу https. Но есть нюанс: по протоколу git возможна авторизация по SSH ключу, а по протоколу https такая авторизация почему-то запрещена, даже если все ключи установлены. Поэтому при использовании репозитария по протоколу https, Git будет всегда запрашивать логин и пароль.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">Теперь возникает вопрос: как комфортно работать с удаленным репозитарием по протоколу https, чтобы все время не вводить логин-пароль на каждую операцию. Оказывается, этот вопрос не так уж и прост. Например, можно попытаться воспользоваться кешированием пароля:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.github.com/articles/caching-your-github-password-in-git/"><span style=" font-family:'Arial'; text-decoration: underline; color:#0000ff;">Caching your GitHub password in Git</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">Но и тут проблема: кеширование пароля (в среде Windows) работает только в нативном Git-шелле </span><span style=" font-family:'Arial'; font-weight:600;">Git for Windows</span><span style=" font-family:'Arial';">. А если пользоваться обычным </span><span style=" font-family:'Arial'; font-weight:600;">cmd</span><span style=" font-family:'Arial';">, то в нем такой возможности нет. Опять же об удобстве использования в нативном окружении Windows не может быть и речи.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">Таким образом, для решения данного вопроса придется идти на крайние меры: прописать логин и пароль прямо в https-линк репозитария. Вот так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">[remote &quot;origin&quot;]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">        url = https://пользователь:пароль@github.com/xintrea/monitoring-sp.git</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial';">Да, это не секьюрно, но другого варианта нормальной работы через socks5-proxy в Windows просто нет.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial';"><br /></p></body></html>