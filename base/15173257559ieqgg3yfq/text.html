<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В мире Git традиционно сложилась странная ситуация, когда документация на важные команды не полностью объясняет что происходит в репозитарии, и вокруг таких команд появляется много мифов. Это отражается и в сторонних статьях, посвященных таким командам, что только добавляет путанницы.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Одна из таких команд - это команда <span style=" font-family:'FreeMono'; color:#6a1009;">git reset</span>, а особенно её опция <span style=" font-family:'FreeMono'; color:#6a1009;">--hard</span>, которой пугают новых пользователей Git. Дескать, она полностью обнуляет историю откаченных коммитов, и вернуть их невозможно. Пользуйтесь ей с осторожностью! </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На самом деле, вот что нужно знать об этой команде:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть несколько простых ситуаций, в которые может попасть пользователь-новичек, и из которых естественным образом можно выйти с помощью <span style=" font-family:'FreeMono'; color:#6a1009;">git reset --hard</span>.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Жесткий сброс не удаляет коммиты, и их можно свободно поместить в дополнительную ветку.</li></ol>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот типичная ситуация, в которой может оказаться программист:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Программист на протяжении нескольких коммитов писал неудачный код в ветке <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span>. Ему нужно откатиться до некоего предыдущего коммита <span style=" font-family:'FreeMono'; color:#6a1009;">a1b2c3</span>, сделать развилку так, чтобы новый код продолжил добавляться в ветку <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span>, а все откаченные изменения оказались бы в ветке <span style=" font-family:'FreeMono'; color:#6a1009;">badExperiment</span> для истории. Воркфлоу в конторе предполагает, что другие программисты сидят в других ветках, и наш программист полностью владеет веткой <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span> (это важно).</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как проще всего поступить в такой ситуации программисту? Надо дать следующие команды:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Находясь на конце ветки <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span>, нужно создать ветку <span style=" font-family:'FreeMono'; color:#6a1009;">badExperiment</span>:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git checkout dev         - переход на конец ветки dev </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git branch badExperiment - создание ветки badExperiment</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь надо обратить внимание, что команда <span style=" font-family:'FreeMono'; color:#6a1009;">git branch</span> вызвана без опции <span style=" font-family:'FreeMono'; color:#6a1009;">-b</span>, то есть ветка создается, но на нее переключения не происходит. Тут нужно напомнить, что имена веток - это просто указатели на коммиты. И после таких команд указатель <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span> и указатель <span style=" font-family:'FreeMono'; color:#6a1009;">badExperiment</span> будут указывать на один и тот же последний коммит.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Далее, находясь в ветке <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span>, нужно сделать хардресет до нужного коммита:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git reset --hard a1b2c3</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Указатель <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span> переместится на этот коммит. А благодаря тому, что была сделана ветка <span style=" font-family:'FreeMono'; color:#6a1009;">badExperiment</span>, все коммиты, сделанные после <span style=" font-family:'FreeMono'; color:#6a1009;">a1b2c3</span> останутся в репозитарии, и их всегда можно будет посмотреть, переключившись на ветку <span style=" font-family:'FreeMono'; color:#6a1009;">badExperiment</span><span style=" font-family:'monospace';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В общем, после этой команды репозитарий считает, что ветка <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span> заканчивается на коммите <span style=" font-family:'FreeMono'; color:#6a1009;">a1b2c3</span><span style=" font-family:'monospace';">.</span> Об этом изменении надо оповестить удаленный репозитарий. Делается это командой:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git push --force</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Опция --force обязательна, так как по сути, происходит откат назад по истории коммитов.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Кроме того, на удаленный репозитарий нужно залить ветку <span style=" font-family:'FreeMono'; color:#6a1009;">badExperiment</span> чтобы руководитель проекта видел, что программист не балду пинал, а неистово работал, хоть и не плодотворно. Залитие ветки <span style=" font-family:'FreeMono'; color:#6a1009;">badExperiment</span> в удаленный репозитарий прозводится командами:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"># переключение на ветку badExperiment</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git checkout badExperiment                </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"># Заливка текущей ветки на удаленный репозитарий origin как badExperiment</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git push --set-upstream origin badExperiment</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier 10 Pitch'; color:#6a0e07;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этих команд можно переключиться на ветку <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span> и продолжить программировать. Все новые коммиты будут продолжать укладываться в ветку <span style=" font-family:'FreeMono'; color:#6a1009;">dev</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>